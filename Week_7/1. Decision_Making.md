# Decision Making

[Downlod the slides here](W7-V0-decision-making.pptx)

:::{iframe} https://www.youtube.com/embed/n_05hOV2hS0
:width: 100%
:::
---

## Introduction

This weekâ€™s sections donâ€™t cover a single theme. Instead, weâ€™ll look at a few different strands of work in neuroscience that could be of interest to people with a machine learning or quantitative background. We may also add more sections in future years.

In this section, weâ€™ll focus on decision making - a really broad topic of course, because in a way you can think of everything the brain has to do is about making decisions.

:::{attention} Note!
We're going to focus on one particular aspect of decision making that has been studied a lot in neuroscience and less in machine learning: Reaction times. 

That is, how long does it take to make a decision based on a stream of information arriving continuously over time.
:::

## Two-Alternative Forced Choice ({abbr}`2AFC(Two-Alternative Forced Choice)`)

Letâ€™s make this even more concrete with a very specific sort of task, the two-alternative forced choice, or {abbr}`2AFC(Two-Alternative Forced Choice)`.

In [this task](#2afc), participants are shown some sort of image or movie and asked to decide between two options. A common one is the random dot kinematogram, with random dots on the screen some of which are moving coherently either to the left or right, and some moving randomly. The participants have to determine which direction the coherent dots are moving, and sometimes theyâ€™re asked to make their decision as quickly as possible. The reaction time is the time between the start of the video and the moment when they press the button.

```{figure} taskreact.png
:label: 2afc
:alt: Random Dot Kinematogram
:align: center

Random Dot Kinematogram Experiment
```
If you run this experiment, you see characteristic skewed distributions of reaction times. [This data](#2afcresult) is actually from a slightly different task where participants were asked whether or not they had seen the image being shown before or not.

```{figure} taskresult.png
:label: 2afcresult
:alt: 2AFC Experiment Results
:align: center

2AFC Experiment Results (See [paper](https://doi.org/10.1037/0033-295X.85.2.59))
```

## Drift Diffusion / Random Walk Model

Thereâ€™s a beautifully simple theory for how we make these decisions which can account for these reaction times:

* Imagine that as time goes by, sometimes a bit of evidence arrives that is on its own unreliable, but suggestive that the dots are moving right rather than left. Then another, followed by one that suggests that left is more likely, and so on. We keep track of a running total of how much evidence weâ€™ve received that suggests right versus left, and once it crosses some threshold we make our decision. This is a biased random walk, where itâ€™s more likely we take a step in the correct direction than the wrong direction.

<!-- ```{figure} 10.png
:label: 10res
:alt: Biased Random Walk With 10 Time Points
:align: center

Biased Random Walk With 10 Time Points
``` -->
(10res)=
![](#10-graph)

* As we increase the number of time points from [10](#10res) to [30](#30res).

<!-- ```{figure} 30.png
:label: 30res
:alt: Biased Random Walk With 30 Time Points
:align: center

Biased Random Walk With 30 Time Points
``` -->

(30res)=
![](#30-graph)

* Then from [30](#30res) to [100](#100res).

<!-- ```{figure} 100.png
:label: 100res
:alt: Biased Random Walk With 100 Time Points
:align: center

Biased Random Walk With 100 Time Points
``` -->

(100res)=
![](#100-graph)

And all the way up to [1000](#1000res), this random walk looks more and more like Brownian motion with a drift. This gives us a mathematical theory that lets us analytically compute expressions for the reaction time distributions.

<!-- ```{figure} 1000.png
:label: 1000res
:alt: Biased Random Walk With 1000 Time Points
:align: center

Biased Random Walk With 1000 Time Points
``` -->

(1000res)=
![](#1000-graph)

* Or we can just numerically plot them, [here](#highlow) with either a low decision threshold or a high decision threshold. 

<!-- ```{figure} distr.png
:label: highlow
:alt: Plot of Reaction Time Distributions for High and Low Decision Thresholds
:align: center

Plot of Reaction Time Distributions for High and Low Decision Thresholds
``` -->

(highlow)=
![](#highlow-graph)

* And sure enough, we get something that looks very much like the data from [experiments](#2afcresult).

## Probabilistic Interpretation

Thatâ€™s nice, but still this model might seem a bit ad hoc. Fortunately, it turns out that thereâ€™s a neat probabilistic interpretation of this model.

* Letâ€™s set up a probabilistic model of the task. Weâ€™ll say thereâ€™s a true direction $D$ that can be either $L$ or $R$, and both options are equally likely. You can actually modify this to make the options have different probabilities too.

```{math}
    \text{True direction } ð·=ð¿ \text{ or } ð·=ð‘… \\
    \text{ equally likely } ð‘ƒ(ð·=ð¿)=ð‘ƒ(ð·=ð‘…)=1/2
```
* Now we have the data observed at time t is a series of symbols $ð‘‹_ð‘¡$ each of which is $R$ or $L$.

```{math}
    \text{Observed data } ð‘‹_ð‘¡=(ð‘…,ð‘…,ð¿,ð‘…,ð¿,ð‘…,ð‘…,ð‘…,â€¦)
```
* The probability you observe the correct symbol is $p$ and the probability you observe the incorrect symbol $1-p$.

```{math}
    \text{Probabilities } ð‘ƒ(ð‘‹_ð‘¡=ð·)=ð‘ \text{ and } ð‘ƒ(ð‘‹_ð‘¡=âˆ’ð·)=1âˆ’ð‘ \\
    \text{where } ð‘>1âˆ’ð‘
```
* Now given we know the observed data and we want to infer the unknown value of $D$, we compute which of the two options is more likely. Weâ€™ll write that as $r(X)$ equals the ratio of the probability that $D=R$ given the observations $X$, divided by the probability itâ€™s $D=L$. If this ratio is high then $D=R$ is much more likely, and if itâ€™s low then $D=L$ is more likely.

```{math}
    \text{Write } ð‘Ÿ(ð‘¿)=\frac{ð‘ƒ(ð·=ð‘…â”‚ð‘¿)}{ð‘ƒ(ð·=ð¿â”‚ð‘¿)} \text{ the likelihood ratio.} \\
    \text{If this is high then } ð·=ð‘… \text{ is more likely.}
```
    
* We use Bayesâ€™ theorem to rewrite the probability that $D=R$ given X in terms of the probability of $X$ given $D=R$ times the probability $D=R$ over the probability of $X$. And the same thing for the probability that $D=L$ on the bottom.

```{math}
    ð‘Ÿ(ð‘¿)=\frac{ð‘ƒ(ð‘¿â”‚ð·=ð‘…)_{P(D=R)/P(ð‘¿)}}{ð‘ƒ(ð‘¿â”‚ð·=L)_{P(D=R)/P(ð‘¿)}}
```

* The $P(X)$ cancels and both the prior probabilities $D=R$ and $D=L$ are both Â½ so they cancel too.

```{math}
    ð‘Ÿ(ð‘¿)=\frac{ð‘ƒ(ð‘¿â”‚ð·=ð‘…)}{ð‘ƒ(ð‘¿â”‚ð·=L)}
```

* The observations at different time points are independent, so we can expand these as a product of the probabilities at each time point.

```{math}
    ð‘Ÿ(ð‘¿)=\frac{\Pi_{t}ð‘ƒ(ð‘¿_tâ”‚ð·=ð‘…)}{\Pi_{t}ð‘ƒ(ð‘¿_tâ”‚ð·=L)}
```

* And this product is the same at the top and bottom so we can pull it out.

```{math}
    ð‘Ÿ(ð‘¿)=\Pi_{t}\frac{ð‘ƒ(ð‘¿_tâ”‚ð·=ð‘…)}{ð‘ƒ(ð‘¿_tâ”‚ð·=L)}
```

* Now to see whatâ€™s going on more clearly we take the log of this ratio to get the log likelihood ratio.

```{math}
    logð‘Ÿ(ð‘¿)=log\Pi_{t}\frac{ð‘ƒ(ð‘¿_tâ”‚ð·=ð‘…)}{ð‘ƒ(ð‘¿_tâ”‚ð·=L)}
```    

* The log of a product is the sum of the logs.

```{math}
    logð‘Ÿ(ð‘¿)=\Sigma_{t}log\frac{ð‘ƒ(ð‘¿_tâ”‚ð·=ð‘…)}{ð‘ƒ(ð‘¿_tâ”‚ð·=L)}
```

* And weâ€™ll write the individual terms as the â€œevidence at time $t$â€ $\epsilon(ð‘‹_ð‘¡)$.

```{math}
     logð‘Ÿ(ð‘¿)=\Sigma_{t}\epsilon(ð‘‹_ð‘¡)
```

* This evidence will be log of $p/1-p$ when $ð‘‹_ð‘¡=ð¿$. If $ð‘‹_ð‘¡=ð‘…$ itâ€™s log of $(1-p)/p$ but this is just negative log of $p/1-p$.

```{math}
    \epsilon(ð‘‹_ð‘¡) = log\frac{p}{1-p} \text{ if } ð‘‹_ð‘¡ = L \\
    \text{or } -log\frac{p}{1-p} \text{ if } ð‘‹_ð‘¡ = R
```

* With that we can write the log likelihood ratio as a constant term multiplied by the sum of terms $\delta(ð‘‹_ð‘¡)$ which are $+1$ if $ð‘‹_ð‘¡=ð‘…$ and $-1$ if $ð‘‹_ð‘¡=ð¿$.

```{math}
    logð‘Ÿ(ð‘¿)=log\frac{p}{1-p} * \Sigma_{t}\delta(ð‘‹_ð‘¡)
```

* But this sum is precisely the random walk we saw previously.

```{math}
    \Sigma_{t}\delta(ð‘‹_ð‘¡) \text{ is random walk!}
```

* When D=R the sum increases by 1 with probability $p$ and decreases by 1 with probability $1-p$, and vice versa if $D=L$.


* We can understand the decision threshold in terms of probability now. We wait until the log likelihood ratio is bigger than some threshold $\theta$ or equivalently that the likelihood ratio is bigger than $ð‘’^{\theta}$.

```{math}
    \text{Decision threshold }\theta \text{: } ð·=ð‘… \text{ more likely if} \\
    logâ¡ð‘Ÿ(ð‘‹)>\theta \text{ or } ð‘Ÿ(ð‘¿)>ð‘’^\theta
```

* And this happens when the sum of the deltas is bigger than some threshold, precisely as in the drift diffusion model.

```{math}
    \text{This is true if } \Sigma_{t}\delta(ð‘‹_ð‘¡) >  \text{const} = \theta / log\frac{p}{1-p}
```
```{figure} probinter.png
:label: probi
:alt: Probabilistic Interpretation of Model
:align: center

Probabilistic Interpretation of Model
```

## Electrophysiological Data

And finally, perhaps the best thing about this theory is that having come up with the model based on fitting behavioural observations and then finding a rigorous probabilistic interpretation, electrophysiological [experiments](#electrophys) find traces of these evidence accumulation processes across multiple different brain regions in multiple species.

```{figure} electro.png
:label: electrophys
:alt: Experimental Evidence of Accumulation Processes Across Multiple Brain Regions and Species
:align: center

Experimental Evidence of Accumulation Processes Across Multiple Brain Regions and Species (See [paper](https://doi.org/10.1016/j.tins.2018.06.005))
```

Of course, itâ€™s never quite as clean cut as the theory and all sorts of modifications have been proposed, like adaptive thresholds that get closer to the origin over time to represent the increasing urgency of making some sort of decision, or thresholds that adapt to wider context in various ways. There are also much more comprehensive Bayesian theories of decision making in which this model is just one special case, and so on. 

:::{seealso} For more
:class: dropdown
If youâ€™re interested in reading more, there are some suggested starting points

* [Ratcliff (1978) "A theory of memory retrieval"](https://doi.org/10.1037/0033-295X.85.2.59)
* [Gold and Shadlen (2007) "The Neural Basis of Decision Making"](https://doi.org/10.1146/annurev.neuro.29.051605.113038)
* [O'Connell et al. (2018) "Bridging Neural and Computational Viewpoints on Perceptual Decision-Making"](https://doi.org/10.1016/j.tins.2018.06.005)
:::

:::{seealso} That's it!
InÂ the next section, weâ€™ll talk about Neuromorphic Computing.
:::